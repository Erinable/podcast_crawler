# 架构文档

## 系统架构

### 整体架构
```
+----------------+     +----------------+     +----------------+
|                |     |                |     |                |
|  HTTP API      |     |  任务调度器     |     |  爬虫工作器     |
|                |     |                |     |                |
+----------------+     +----------------+     +----------------+
         |                    |                     |
         |                    |                     |
         v                    v                     v
+----------------+     +----------------+     +----------------+
|                |     |                |     |                |
|  PostgreSQL    |<--->|    Redis       |<--->|   对象存储      |
|                |     |                |     |                |
+----------------+     +----------------+     +----------------+
```

### 核心组件

1. HTTP API 服务
   - 提供 RESTful API
   - 处理请求验证和响应格式化
   - 实现速率限制和缓存

2. 任务调度器
   - 管理爬虫任务队列
   - 调度任务执行
   - 监控任务状态

3. 爬虫工作器
   - 执行 RSS feed 抓取
   - 解析播客数据
   - 下载音频文件

4. 存储系统
   - PostgreSQL：结构化数据存储
   - Redis：缓存和任务队列
   - 对象存储：音频文件和图片

## 模块说明

### 1. Crawler 模块
位置：`src/crawler/`
- feed.rs: RSS feed 解析
- downloader.rs: 文件下载器
- extractor.rs: 数据提取器
- scheduler.rs: 任务调度器

### 2. API 模块
位置：`src/api/`
- handlers/: 请求处理器
- middleware/: 中间件
- routes.rs: 路由定义
- models.rs: API 数据模型

### 3. 存储模块
位置：`src/infrastructure/persistence/`
- database.rs: 数据库操作
- cache.rs: 缓存操作
- storage.rs: 对象存储操作

### 4. 任务调度模块
位置：`src/infrastructure/task/`
- queue.rs: 任务队列
- worker.rs: 工作器
- scheduler.rs: 调度器

## 技术栈

### 1. 后端技术
- Rust 1.70+
- Actix-web: Web 框架
- Tokio: 异步运行时
- Serde: 序列化/反序列化

### 2. 数据库
- PostgreSQL 14+
- Diesel: ORM
- Redis: 缓存和队列

### 3. 工具链
- Cargo: 包管理器
- Docker: 容器化
- GitHub Actions: CI/CD

## 设计决策

### 1. 技术选型理由
- Rust：安全性和性能
- PostgreSQL：数据一致性和事务支持
- Redis：高性能缓存和任务队列
- Actix-web：高性能异步 Web 框架

### 2. 架构决策记录

#### ADR-001: 使用 Rust
- 状态：已接受
- 背景：需要高性能和内存安全
- 决策：选择 Rust 作为主要开发语言
- 后果：开发效率可能略低，但获得更好的性能和安全性

#### ADR-002: 分布式架构
- 状态：已接受
- 背景：需要支持横向扩展
- 决策：采用分布式架构设计
- 后果：增加了系统复杂性，但提高了可扩展性

## 安全设计

### 1. 认证授权
- JWT 基础设施
- 基于角色的访问控制
- API 密钥管理

### 2. 数据安全
- 数据加密存储
- 敏感信息脱敏
- 备份和恢复策略

### 3. 网络安全
- TLS/SSL 加密
- API 速率限制
- DDoS 防护

## 扩展性设计

### 1. 水平扩展
- 无状态 API 服务
- 分布式任务调度
- 可扩展存储架构

### 2. 垂直扩展
- 资源限制配置
- 性能监控和优化
- 缓存策略

### 3. 服务解耦
- 模块化设计
- 消息队列通信
- 微服务架构准备
